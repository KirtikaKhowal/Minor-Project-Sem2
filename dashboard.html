<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Arial;background:#f4f7fb;margin:0}

header{background:#4f46e5;color:#fff;padding:15px;display:flex;justify-content:space-between}

.card{background:#fff;margin:20px auto;padding:20px;border-radius:10px;max-width:900px}

input,button{width:100%;padding:10px;margin-top:10px}

button{background:#4f46e5;color:#fff;border:none}

.task{background:#eef2ff;padding:10px;margin-top:10px;border-radius:6px}

.task:hover {
  background: #e0e7ff;
  cursor: pointer;
}

.dark {
  background: #111827;
  color: #e5e7eb;
}

.dark .card {
  background: #1f2933;
}

.dark input,
.dark button {
  background: #374151;
  color: white;
  border: 1px solid #555;
}

body {
  transition: background 0.3s, color 0.3s;
}
</style>
</head>
<body>
<script>
let user=localStorage.getItem('currentUser');if(!user)location.href='login.html';
</script>
<header>
<h3>Welcome, <span id="u"></span></h3>
<button onclick="logout()">Logout</button>
<button onclick="toggleDark()">ðŸŒ™ Dark Mode</button>
</header>

<div class="card">
<h2>Add Assignment</h2>
<input id="task" placeholder="Task name">
<input id="subject" placeholder="Subject">
<input type="datetime-local" id="deadline">
<button onclick="addTask()">Add</button>
<div id="tasks"></div>
</div>

<div class="card">
<h2>Stress Tracker</h2>
<input type="number" id="stress" min="1" max="10">
<button onclick="saveStress()">Save</button>
<canvas id="chart"></canvas>
</div>

<script>

function toggleDark() {
  document.body.classList.toggle('dark');
  localStorage.setItem(
    'theme',
    document.body.classList.contains('dark') ? 'dark' : 'light'
  );
}

if (localStorage.getItem('theme') === 'dark') {
  document.body.classList.add('dark');
}

document.getElementById('u').innerText=user;
function logout(){localStorage.removeItem('currentUser');location.href='login.html';}

let allTasks=JSON.parse(localStorage.getItem('tasks'))||{};
allTasks[user]=allTasks[user]||[];

function addTask(){let obj={t:task.value,s:subject.value,d:deadline.value};allTasks[user].push(obj);localStorage.setItem('tasks',JSON.stringify(allTasks));render();setReminder(obj)}

function render(){tasks.innerHTML='';allTasks[user].forEach(x=>{let left=Math.round((new Date(x.d)-new Date())/60000);tasks.innerHTML+=`<div class='task'><b>${x.t}</b><br>${x.s}<br>${new Date(x.d).toLocaleString()}<br>â³ ${left>0?left+' min left':'Expired'}</div>`})}

function setReminder(x){let diff=new Date(x.d)-new Date();if(diff>0)setTimeout(()=>new Notification('Deadline Reminder',{body:x.t}),diff)}
Notification.requestPermission();

let stressData=JSON.parse(localStorage.getItem('stress_'+user))||[];
function saveStress(){stressData.push(stress.value);localStorage.setItem('stress_'+user,JSON.stringify(stressData));new Chart(chart,{type:'line',data:{labels:stressData.map((_,i)=>'Day '+(i+1)),datasets:[{data:stressData}]}})}
render();
</script>
</body>
</html>